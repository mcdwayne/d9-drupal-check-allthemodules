<?php

/**
 * @file
 * The paragraphs_entity_embed functionality.
 */

/**
 * Implements hook_entity_type_build().
 *
 * Adds a custom Form Class to Paragraph Embed entities, so we can add custom
 * actions and potentially override normal Entity CRUD operations.
 */
function paragraphs_entity_embed_entity_type_build(array &$entity_types) {
  if (isset($entity_types['embedded_paragraphs'])) {
    $entity_types['embedded_paragraphs']->setFormClass('paragraphs_entity_embed', 'Drupal\paragraphs_entity_embed\Form\ParagraphEmbedDialog');
  }
}

/**
 * Implements hook_preprocess_HOOK().
 *
 * On displaying the Paragraph Embed add/edit forms in iframe hide all page
 * elements except that what is inside the content area.
 */
function paragraphs_entity_embed_preprocess_html(&$variables) {
  if (
    !empty($variables['is_admin']) &&
    in_array(\Drupal::routeMatch()->getRouteName(), [
      'paragraphs_entity_embed.dialog',
      'paragraphs_entity_embed_edit.dialog',
    ])) {
    if (isset($variables['page_top'])) {
      $variables['page_top']['#access'] = FALSE;
    }
    if (isset($variables['page_bottom'])) {
      $variables['page_bottom']['#access'] = FALSE;
    }
    if (isset($variables['page'])) {
      foreach (array_keys($variables['page']) as $key) {
        if (strpos($key, '#') !== 0 && $key !== 'content') {
          $variables['page'][$key]['#access'] = FALSE;
        }
      }
    }
  }
}
