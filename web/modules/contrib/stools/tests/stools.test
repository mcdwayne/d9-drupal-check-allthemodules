<?php

/**
 * Tests.
 */

/**
 * StoolsTests tests.
 */
class StoolsTests extends DrupalWebTestCase {

  /**
   * Simple test info.
   */
  public static function getInfo() {
    return [
      'name' => 'Some tools tests',
      'description' => 'Tests the stools module',
      'group' => 'Stools',
    ];
  }

  /**
   * Set up.
   */
  public function setUp() {
    parent::setUp(['stools']);
  }

  /**
   * Test stools_concat_field_values().
   */
  public function testFieldConcatValues() {
    $entity = new stdClass();
    $entity->field_example = [
      LANGUAGE_NONE => [
        [
          'value' => 'abc',
        ],
      ],
    ];
    $entity->field_second_example = [
      LANGUAGE_NONE => [
        [
          'value' => 'def',
        ],
      ],
    ];

    $this->assertEqual(stools_concat_field_values($entity, ['field_example', 'field_second_example']), 'abc, def');
  }

  /**
   * Test stools_field_has_value().
   */
  public function testFieldHasValue() {
    $entity = new stdClass();
    $entity->field_name = [
      LANGUAGE_NONE => [
        [
          'value' => 123,
        ],
      ],
    ];
    $this->assertTrue(stools_field_has_value($entity, 'field_name'));

    $entity->field_name = [
      LANGUAGE_NONE => [
        [
          'target_id' => 123,
        ],
      ],
    ];
    $this->assertTrue(stools_field_has_value($entity, 'field_name'));

    $entity->field_name = [
      LANGUAGE_NONE => [
        [
          'asdf' => 123,
        ],
      ],
    ];
    $this->assertTrue(stools_field_has_value($entity, 'field_name'));
  }

  /**
   * Test stools_field_has_value() when no value is present.
   */
  public function testFieldHasValueReturnsFalse() {
    $entity = new stdClass();
    $entity->field_name = [];

    $this->assertFalse(stools_field_has_value($entity, 'field_name'));
    $entity->field_name = [LANGUAGE_NONE => []];
    $this->assertFalse(stools_field_has_value($entity, 'field_name'));

    $entity->field_name[LANGUAGE_NONE][0] = ['value' => NULL];
    $this->assertFalse(stools_field_has_value($entity, 'field_name'));
  }

  /**
   * Test stools_field_value().
   */
  public function testFieldValue() {
    $entity = new stdClass();
    $entity->field_name = [
      LANGUAGE_NONE => [
        [
          'value' => 123,
        ],
      ],
    ];

    $this->assertEqual(stools_field_value($entity, 'field_name'), 123);

    $entity->field_name = [
      LANGUAGE_NONE => [
        [
          'value' => 123,
        ],
        [
          'value' => 456,
        ],
      ],
    ];
    $result = stools_field_value($entity, 'field_name');
    $this->assertTrue(is_array($result));
    $this->assertEqual($result[0], 123);
    $this->assertEqual($result[1], 456);
  }

  /**
   * Test stools_field_value() with target_id.
   */
  public function testFieldValueWithTargetId() {
    $entity = new stdClass();
    $entity->field_name = [
      LANGUAGE_NONE => [
        [
          'target_id' => 123,
        ],
      ],
    ];

    $this->assertEqual(stools_field_value($entity, 'field_name'), 123);

    $entity->field_name = [
      LANGUAGE_NONE => [
        [
          'target_id' => 123,
        ],
        [
          'target_id' => 456,
        ],
      ],
    ];
    $result = stools_field_value($entity, 'field_name');
    $this->assertTrue(is_array($result));
    $this->assertEqual($result[0], 123);
    $this->assertEqual($result[1], 456);
  }

  /**
   * Test stools_string_startswith().
   */
  public function testStartswith() {
    $this->assertTrue(stools_string_startswith('hello', 'he'));
    $this->assertTrue(stools_string_startswith('hello', 'hello'));
    $this->assertFalse(stools_string_startswith('hello', 'ello'));
    $this->assertFalse(stools_string_startswith('hello', 'hello, world'));
  }

  /**
   * Test stools_string_endswith().
   */
  public function testEndswith() {
    $this->assertTrue(stools_string_endswith('hello', 'lo'));
    $this->assertTrue(stools_string_endswith('hello', 'llo'));
    $this->assertTrue(stools_string_endswith('hello', 'hello'));
    $this->assertFalse(stools_string_endswith('hello', 'world'));
    $this->assertFalse(stools_string_endswith('hello', 'hello, world'));
  }

  /**
   * Test stools_field_contains_value() with tid items.
   */
  public function testFieldContainsValueWithTid() {
    $entity = new stdClass();
    $entity->field_something = [
      'und' => [
        ['tid' => '111'],
      ],
    ];

    $this->assertTrue(stools_field_contains_value($entity, 'field_something'), 111);
  }

}
