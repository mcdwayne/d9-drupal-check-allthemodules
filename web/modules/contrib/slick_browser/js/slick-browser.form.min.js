!function(a,b){"use strict";function c(c,d){function o(b){b.preventDefault();var c=b.currentTarget;return q(c),m.length?(a(".button-wrap--show-selection",d).show(),m.sortable("refresh"),void e.removeClass("is-collapsed")):(e.addClass("is-collapsed"),!1)}function p(c){var d=a(c),f=a('input[name^="entity_browser_select"]',c),g=f.val(),h=g.split(":"),i=h[1],j=a("img",c),k=a(".media",c).data("thumb"),l=a(".views-field--selection",c).length?a(".views-field--selection",c):a(".views-field:nth-child(2)",c),n=null;if(e.removeClass("is-empty"),d.attr("data-entity-id",i).attr("data-entity",g),k?n=a('<img src="'+k+'" alt="'+b.t("Thumbnail")+'">'):j.length?n=j:l.length&&(n=l),null!==n&&m.length){n.clone().addClass("item-selected").detach().appendTo(m).wrapAll('<div class="item-container" data-entity-id="'+i+'" data-entity="'+g+'" />').once();var o='<input class="weight" value="" type="hidden" />',p='<span class="button-wrap button-wrap--remove"><input value="Remove" class="button button--remove button--remove-js" type="button"></span>';a(".item-container",m).each(function(b){var c=a(this);a(".weight",c).length||(c.append(p),c.append(o),a(".button--remove",c).attr("data-entity",g).attr("data-remove-entity","items_"+g).attr("name","remove_"+i+"_"+b),a(".weight",c).val(b).attr("name","selected[items_"+i+"_"+b+"][weight]"))}),f.prop("checked")||m.find('.item-container[data-entity="'+g+'"]').remove()}}function q(b){var c=a(b),d='input[name^="entity_browser_select"]',f=a(d,b),g=f.val(),h=c.closest(".view--sb"),i=function(){f.prop("checked",!f.prop("checked")).attr("data-entity",g),c[f.prop("checked")?"addClass":"removeClass"]("is-marked is-checked"),a(".button--select",b).html(f.prop("checked")?"&#10003;":"&#43;")},j=function(){f.prop("checked",!1),c.removeClass("is-marked is-checked"),a(".button--select",b).html("&#43;"),m.length&&m.find('.item-container[data-entity="'+g+'"]').remove()},k=function(){a(d).not(c.find("input")).prop("checked",!1),h.find(".grid").not(this).removeClass("is-marked is-checked")};switch(n){case 1:if(h.find(".was-checked").length)return!1;k(),i(),p(b),m.length&&m.find('.item-container:not([data-entity="'+g+'"])').remove();break;case-1:i(),p(b);break;default:var l=h.find(".is-marked").length+1;if(e[l===n?"addClass":"removeClass"]("form--overlimit"),l>n)return c.hasClass("is-checked")?(j(),e.removeClass("form--overlimit")):e.addClass("form--overlimit"),!1;i(),p(b)}}function r(b){b.preventDefault();var c=a(b.currentTarget),d=c.closest(".item-container"),f=d.data("entity"),h=(c.closest(".grid"),a(b.delegateTarget).find('input[name="entity_browser_select['+f+']"]')),i=e.find('.is-marked[data-entity="'+f+'"]');i.removeClass("is-marked is-checked"),h.prop("checked",!1).closest(".is-checked").removeClass("is-marked is-checked"),d.remove(),e.removeClass("form--overlimit"),a(".button--select",i).html("&#43;"),t()&&u()}function s(b){a(b.currentTarget);e.toggleClass("is-collapsed"),e.hasClass("form--selection-v")&&e.find(".slick__slider").length&&window.setTimeout(function(){e.find(".slick__slider")[0].slick.refresh()},40)}function t(){return!h.find(".item-container").length}function u(){a(".button-wrap--show-selection",h).hide(),e.addClass("is-empty is-collapsed")}function v(c,e){var k,f=a(e).data("entityId"),g=i.val().split(":")[0],h=a('input[name="entity_browser_select['+g+":"+f+']"]',d),j=b.t("Was selected");h.length&&(h.prop("checked",!1).attr("disabled","disabled"),k=h.closest(".grid").addClass("is-marked was-checked"),k.find("img").length?k.find("img").attr("title",j):k.attr("title",j))}function w(){var b=a('<button id="edit-use-selected-clone" class="button button--primary button--sb button--use-selected-clone">'+k+"</button>"),c=g.eq(0).find(".ui-dialog-titlebar-close");j.length&&!g.find(l).length&&b.insertBefore(c),g.on("click.sbDialogInsert",l,function(b){a(b.delegateTarget).addClass("media--loading"),j.click()})}function x(){e.removeClass("is-empty")}function y(){return e.closest("body").addClass("sb-body"),g.length&&e.addClass("form--dialog"),a("> div:not(.sb__header, .sb__footer)",d).addClass("sb__main"),t()?(u(),void(g.length&&g.find(l).remove())):(g.length&&w(),a(l).text(k).removeClass("visually-hidden"),void(i.length&&(e.removeClass("is-empty"),h.find(".item-container").each(v))))}var e=a(d),f=a(window.parent.document),g=a(".ui-dialog:visible",f),h=a("#edit-footer",d),i=a('input[name*="entity_browser_select"]',d),j=a('.button[name="use_selected"]',d),k=j.length?j.val():b.t("Add to Page"),l="#edit-use-selected-clone",m=a("#edit-selected",d).removeClass("hidden"),n=e.data("cardinality")||-1;e.on("click.sbGrid",".grid:not(.view-list--header, .was-checked)",o),e.on("click.sbRemove",".button--remove-js",r),e.on("click.sbShow",".button--show-selection",s),e.on("click.sbUpload",".js-form-file, .dz-clickable",x),e.on("click.sbInsert","#edit-use-selected",b.slickBrowser.loading),y()}b.behaviors.slickBrowserForm={attach:function(b){a(".form--sb",b).once("sbForm").each(c)},detach:function(b,c,d){"unload"===d&&a(".form--sb",b).removeOnce("sbForm").off(".sbGrid .sbInsert .sbRemove .sbShow .sbUpload")}}}(jQuery,Drupal);
